generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Session {
  id                  String    @id
  shop                String
  state               String
  isOnline            Boolean   @default(false)
  scope               String?
  expires             DateTime?
  accessToken         String
  userId              BigInt?
  firstName           String?
  lastName            String?
  email               String?
  accountOwner        Boolean   @default(false)
  locale              String?
  collaborator        Boolean?  @default(false)
  emailVerified       Boolean?  @default(false)
  refreshToken        String?
  refreshTokenExpires DateTime?

  @@unique([shop, isOnline])
}

model Bundle {
  id                String   @id @default(uuid())
  name              String
  collectionId      String
  collectionTitle   String
  rules             String
  discountCodes     Json?
  shopifyDiscountId String?

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([collectionId])
  @@index([createdAt])
}

model DiscountCode {
  id             String   @id @default(cuid())
  code           String   @unique
  bundleId       String
  ruleIndex      Int
  customerId     String?
  sessionId      String?
  discountNodeId String
  used           Boolean  @default(false)

  createdAt      DateTime @default(now())
  expiresAt      DateTime

  @@index([bundleId, ruleIndex])
  @@index([customerId])
  @@index([sessionId])
  @@index([used])
  @@index([createdAt])
  @@index([bundleId, ruleIndex, customerId, sessionId])
}
